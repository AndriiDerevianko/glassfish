{
    "jpsType": "install",
    "jpsVersion": "0.7",
    "application": {
        "name": "Glassfish Cluster",
        "version": "1.0.0",
        "env": {
            "topology": {
                "nodes": [{
                    "nodeType": "docker",
                    "extip": false,
                    "displayName": "das",
                    "nodeGroup": "das",
                    "cloudlets": 32,
                    "docker": {
                        "image": "andretadeu/glassfish",
                        "env": {
                            "DAS": "true"
                        },
                        "registry": {
                            "url": "registry.hub.docker.com"
                        }
                    }
                },
                {
                    "nodeType": "docker",
                    "extip": false,
                    "displayName": "worker",
                    "nodeGroup": "cp",
                    "cloudlets": 24,
                    "count": 2,
                    "docker": {
                        "image": "andretadeu/glassfish",
                        "links": ["das:das"],
                        "registry": {
                            "url": "registry.hub.docker.com"
                        }
                    }
                },
                {
                    "nodeType": "docker",
                    "extip": true,
                    "displayName": "nginx",
                    "nodeGroup": "bl",
                    "cloudlets": 8,
                    "docker": {
                        "image": "andretadeu/simple-nginx-load-balancer",
                        "links": ["das:host0", "node1:host1", "node2:host2"],
                        "env": {
                            "HOSTS": "host0_1:8080,host1_1:28080,host2_1:28080"
                        },
                        "registry": {
                            "url": "registry.hub.docker.com"
                        }
                    }
                }]
            },
            "onBeforeScaleIn[nodeGroup:cp]": {
                "forEach(event.response.nodes)": {
                    "execCmd": {
                        "nodeId": "${@i.id}",
                        "commands": "cd / && ./run.sh gf:stop"
                    }
                }
            }
        },
        "onInstall": [{
                "log": "${placeholders}"
            }, {
            "call": [{
                "procedure": "script",
                "params": {
                    "displayName": "glassfish"
                }
            },
            {
                "procedure": "script",
                "params": {
                    "displayName": "glassfish"
                }
            },
            {
                "procedure": "script",
                "params": {
                    "displayName": "nginx"
                }
            }],
            "executeScript": {
                "type": "js",
                "script": "https://download.jelastic.com/public.php?service=files&t=ffbf704b963644640d8bbc5ef809604b&download",
                "params": {
                    "nodeGroup": "das",
                    "name": "GlassFishAdminPort",
                    "port": "4848"
                }
            }
        }],
        "procedures": [{
            "id": "script",
            "onCall": [{
                "executeScript": {
                    "type": "js",
                    "script": "http://owncloud.demo.jelastic.com/public.php?service=files&t=478044425bddca6cd4a9e8ca484e7341&download"
                }
            }]
        }]
    }
}
